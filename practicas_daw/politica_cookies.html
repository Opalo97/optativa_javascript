<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pisos & Inmuebles</title>
  <!-- Links-->
  <link rel="stylesheet" href="../../iconos/fontello-88eddae3/css/fontello.css">
  <link rel="stylesheet" href="basic.css" title="Modo Claro">
  <link rel="stylesheet" href="forms.css">
  <link rel="alternate stylesheet" href="modo-oscuro.css" title="Modo Oscuro">
  <link rel="stylesheet" href="print.css" media="print">
  <link rel="alternate stylesheet" href="accesible.css" title="Accesible">
  <link rel="alternate stylesheet" href="alto-contraste.css" title="Modo Alto Contraste">
</head>
<body>
  <header>
    <section>
      <div class="cabecera">
        <article class="a_logo">
          <a href="index.html"><img src="img/logo.png" alt="Logo"></a>
        </article>

        <article class="a_titulo">
          <h1>Pisos & Inmuebles</h1>
          <p>La llave de tu nuevo hogar está aquí</p>
        </article>

        <article class="a_identificarse">
          <a href="cuenta.html" class="icon-user-outline" title="Cuenta"></a>
        </article>
      </div>

    </section>
  </header>

  <nav aria-label="Navegación principal">
    <a href="index.html">Inicio</a>
    <a href="f.busqueda.html">Búsqueda completa</a>
  </nav>

  <main class="contenido">
    <section>
      <h2>Política de cookies</h2>
      <p>Este sitio utiliza cookies propias para recordar la selección de estilo y mejorar la experiencia del usuario.</p>
      <ul>
        <li><strong>Cookies necesarias</strong>: consentimiento de cookies (almacenado 90 días).</li>
        <li><strong>Cookies de preferencia</strong>: estilo seleccionado (almacenado 45 días si se aceptan cookies).</li>
      </ul>

      <p>Puede aceptar o rechazar las cookies desde aquí. Si cambia su decisión, la nueva elección se aplicará inmediatamente.</p>

      <div id="policy-actions">
        <button id="btn-accept" class="button">Aceptar cookies</button>
        <button id="btn-reject" class="button">Rechazar cookies</button>
      </div>

      <div id="policy-status"></div>
      
        <h3>Gestión de cookies</h3>
        <p id="info-cookies">Pulse el botón para borrar las cookies de preferencia (no se eliminará el consentimiento).</p>
        <div style="margin:12px 0;">
          <button id="btn-borrar-cookies" class="button">Borrar cookies</button>
        </div>
    </section>
  </main>

  <footer>
    <p>Lucía Vidal Ortiz &amp; Miriam Mendiola Soriano</p>
    <p>&copy; 2025 Pisos & Inmuebles</p>
      <p><a href="politica_cookies.html">Política de cookies</a></p>
  </footer>

  <script src="estilos_cookies.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // cookie API: use window._ec if available
        const cookieAPI = (function () {
          if (window._ec && window._ec.getCookie && window._ec.setCookie && window._ec.deleteCookie) {
            return { get: window._ec.getCookie, set: window._ec.setCookie, del: window._ec.deleteCookie };
          }
          return {
            get: function (n) {
              const m = document.cookie.split('; ').find(r => r.startsWith(n + '='));
              return m ? decodeURIComponent(m.split('=')[1]) : null;
            },
            set: function (n, v, d) {
              let c = n + '=' + encodeURIComponent(v) + '; path=/';
              if (d && Number(d) > 0) {
                const dd = new Date(); dd.setTime(dd.getTime() + d * 24 * 60 * 60 * 1000);
                c += '; expires=' + dd.toUTCString();
              }
              document.cookie = c;
            },
            del: function (n) { document.cookie = n + '=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT'; }
          };
        })();

        function parseCookies() {
          if (!document.cookie || document.cookie === '') return [];
          return document.cookie.split('; ').map(function (pair) {
            const idx = pair.indexOf('=');
            const name = pair.substring(0, idx);
            const value = pair.substring(idx + 1);
            return { name: name, value: decodeURIComponent(value) };
          });
        }

        function showMessage(msg) {
          // style and timing aligned with banner transient message
          const el = document.createElement('div');
          el.textContent = msg;
          el.style.position = 'fixed';
          el.style.bottom = '20px';
          el.style.left = '50%';
          el.style.transform = 'translateX(-50%)';
          el.style.background = '#4caf50';
          el.style.color = '#fff';
          el.style.padding = '8px 12px';
          el.style.borderRadius = '4px';
          el.style.zIndex = '10000';
          document.body.appendChild(el);
          setTimeout(function () { el.remove(); }, 5000);
        }

        // The UI no longer shows a cookies table. Use the single "Borrar cookies" button below.

        const status = document.getElementById('policy-status');
        function refreshStatus() {
          const c = cookieAPI.get('consent');
          const e = cookieAPI.get('estilo');
          status.innerHTML = '<p>Consentimiento: ' + (c ? c : 'no establecido') + '</p>' + '<p>Estilo guardado: ' + (e ? e : 'ninguno') + '</p>';
        }

        document.getElementById('btn-accept').addEventListener('click', function () {
          cookieAPI.set('consent','accepted',90);
          // persistir estilo actual si existe
          const current = window._ec && window._ec.getActiveStyleTitle ? window._ec.getActiveStyleTitle() : null;
          if (current) cookieAPI.set('estilo', current, 45);
          // if estilos_cookies exposed href, save it too
          if (window._ec && window._ec.getActiveStyleHref) {
            const href = window._ec.getActiveStyleHref();
            if (href) cookieAPI.set('estilo_href', href, 45);
          }
          refreshStatus();
          showMessage('Cookies aceptadas');
        });

        document.getElementById('btn-reject').addEventListener('click', function () {
          cookieAPI.set('consent','rejected',90);
          cookieAPI.del('estilo');
          cookieAPI.del('estilo_href');
          refreshStatus();
          showMessage('Cookies rechazadas');
        });

        // Delete cookies button: removes all cookies including 'consent' so the banner is shown again
        document.getElementById('btn-borrar-cookies').addEventListener('click', function () {
          const list = parseCookies();
          list.forEach(function (c) {
            cookieAPI.del(c.name);
          });
          refreshStatus();
          showMessage('Cookies borradas. Se volverá a pedir consentimiento.');
          // reload after a short delay so estilos_cookies.js will detect missing consent and show banner
          setTimeout(function () { location.reload(); }, 800);
        });

        refreshStatus();
      });
    </script>
</body>
</html>
